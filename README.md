# SunKeyword 智能词库回复插件

一个专注于关键词自动回复功能的轻量级 AstrBot 插件，支持智能数据库迁移和简洁的管理界面。

## 🎯 功能特性

### 🔧 核心功能

#### 1. 智能词库管理 (ck 命令)
**管理员功能：**
- 添加词库: `/sunos ck add <关键词> <回复内容>`
  - 智能重复检测，避免重复关键词
  - 支持多行回复内容
  - 示例：`/sunos ck add hello "你好！欢迎使用SunKeyword"`
- 删除词库: `/sunos ck del <序号>`
  - 通过序号精确删除指定词库条目
  - 示例：`/sunos ck del 1`

**用户功能：**
- 查看词库: `/sunos ck list`
  - 显示所有词库条目及其序号
  - 智能预览长回复内容
  - 显示词库统计信息

#### 2. 智能自动回复功能
- **严格相等匹配（忽略字母大小写）**: 所有关键词采用严格相等匹配，字母大小写不敏感；空格与符号必须完全一致。
- **即时响应**: 匹配到关键词后立即发送对应回复
- **命令过滤**: 智能跳过插件命令与插件提示，避免自触发

### 🛠️ 技术特性

#### 智能数据库迁移
- **自动检测**: 启动时自动检测是否存在旧版本数据库
- **安全迁移**: 从 `data/sunos_plugin.db` 迁移到 `data/sunos/sunos_keywords.db`
- **数据备份**: 迁移前自动创建备份文件
- **错误恢复**: 迁移失败时自动清理，保护原数据

#### 架构设计
- **极简设计**: 去除复杂的MVC架构，使用直接的SQLite操作
- **单一职责**: 专注关键词管理，不包含其他群聊管理功能
- **轻量级**: 仅使用Python标准库，无外部依赖
- **高性能**: 直接数据库访问，响应速度快

#### 兼容性
- **标准化路径**: 遵循AstrBot插件最佳实践的数据存储结构
- **向后兼容**: 自动从v3.0升级，保持数据完整性
- **插件系列**: 保持SunOS系列插件的命令前缀统一性

## 🚀 安装和使用

### 安装说明

1. 将插件文件放置在 AstrBot 的插件目录中：`data/plugins/sunos/`
2. 重启 AstrBot 或在管理面板中重载插件
3. 插件会自动：
   - 创建新的数据库目录：`data/sunos/`
   - 检测并迁移旧数据库（如果存在）
   - 初始化词库数据表

### 基础使用

```bash
# 查看帮助（支持 / 或 . 前缀）
/sunos ck help
.sunos ck help

# 查看词库列表（支持 / 或 . 前缀）
/sunos ck list
.sunos ck list

# 添加关键词（需要管理员权限）
/sunos ck add hello "你好！很高兴见到你"
.sunos ck add hello "你好！很高兴见到你"

# 删除关键词（需要管理员权限）
/sunos ck del 1
.sunos ck del 1

# 测试自动回复
# 发送包含"hello"的消息，插件会自动回复
```

### 命令总览

| 命令 | 权限要求 | 功能描述 |
|------|----------|----------|
| `/sunos ck list` | 所有用户 | 查看所有词库条目 |
| `/sunos ck add <词> <回复>` | 管理员 | 添加新的关键词和回复 |
| `/sunos ck del <序号>` | 管理员 | 删除指定序号的词库条目 |

**注意**: `/sunos help` 由主控SunOS插件处理，本插件专注于 `ck` 词库功能。

## 📁 数据存储

### 数据库结构
```sql
-- 位置: data/sunos/sunos_keywords.db
CREATE TABLE keywords (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    keyword TEXT NOT NULL,
    reply TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 迁移过程
1. **检测阶段**: 启动时检查 `data/sunos_plugin.db` 是否存在
2. **备份阶段**: 创建 `data/sunos_plugin.db.backup` 备份文件
3. **迁移阶段**: 将关键词数据复制到新位置
4. **验证阶段**: 确认数据迁移完整性

## 🔧 配置和扩展

### 无依赖设计
本插件专为简洁性设计，仅使用Python标准库：
- `sqlite3` - 数据库操作
- `shutil` - 文件操作（用于数据迁移）
- `typing` - 类型注解

### 性能特点
- **快速启动**: 简单的初始化流程
- **低内存占用**: 精简的代码结构
- **即时响应**: 直接数据库查询，无缓存延迟

## 📝 使用场景

- **群聊知识库**: 建立常见问题的自动回答系统
- **服务机器人**: 提供常用信息的快速回复
- **互动增强**: 通过关键词回复增加聊天趣味性
- **工作助手**: 设置工作相关的快捷回复

## 📊 版本历史

- **v3.1.0**: 
  - 智能数据库迁移功能
  - 标准化数据存储路径
  - 移除复杂架构，专注词库功能
  - 优化命令处理逻辑
- **v3.0.0**: 简化版重构，去除MVC架构
- **v2.0.0**: 现代化MVC架构版本
- **v1.0.0**: 初始版本

## 👥 作者

**Akuma** - [GitHub](https://github.com/Akuma-real/sunos-sunkeyword)

## 📄 许可证

本项目基于 MIT 许可证开源。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个插件！

---

> 💡 **提示**: 这是 SunOS 插件系列的一部分，专注于词库管理功能。如需其他群聊管理功能，请安装对应的 SunOS 系列插件。
